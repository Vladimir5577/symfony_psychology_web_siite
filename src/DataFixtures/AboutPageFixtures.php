<?php

namespace App\DataFixtures;

use App\Entity\Block;
use App\Entity\Page;
use App\Entity\Post;
use Doctrine\Bundle\FixturesBundle\Fixture;
use Doctrine\Persistence\ObjectManager;

class AboutPageFixtures extends Fixture
{
    public function load(ObjectManager $manager): void
    {
        $page = new Page();
        $page->setTitle('Обо мне');
        $page->setSlug('about');
        $page->setPosition(2);
        $page->setIsActive(true);
        $manager->persist($page);
        $this->addReference('page-about', $page);

        $blocksConfig = [
            [
                'title' => 'About hero',
                'slug' => 'about_hero',
                'description' => 'Hero-блок страницы «Обо мне»: заголовок и вступление.',
                'position' => 0,
                'posts' => [
                    [
                        'title' => 'Обо мне',
                        'description' => 'Я психолог, работаю со взрослыми в формате индивидуального консультирования. Помогаю разбираться в тревоге, стрессе, отношениях и кризисных состояниях. В работе опираюсь на доказательные подходы и принципы профессиональной этики: конфиденциальность, уважение к вашему выбору и темпу, отсутствие осуждения.',
                        'position' => 0,
                    ],
                ],
            ],
            [
                'title' => 'Mission / Story',
                'slug' => 'about_mission',
                'description' => 'Почему занимаюсь психологией и как вижу свою задачу.',
                'position' => 1,
                'posts' => [
                    [
                        'title' => 'Почему я в профессии',
                        'description' => 'Верю, что каждому человеку важно иметь пространство, где можно быть услышанным и разбираться в своих переживаниях без давления и советов «как надо». Моя задача — не давать готовые решения, а создавать условия, в которых вы сможете лучше понимать себя, свои чувства и потребности и находить собственные ответы. В работе придерживаюсь научно обоснованных методов и не использую эзотерику, диагностку и прочие неподтверждённые практики.',
                        'position' => 0,
                    ],
                ],
            ],
            [
                'title' => 'Values / Approach',
                'slug' => 'about_values',
                'description' => 'Ценности и принципы работы.',
                'position' => 2,
                'posts' => [
                    [
                        'title' => 'Безопасность и принятие',
                        'description' => 'Создаю пространство, в котором можно говорить о сложном без страха осуждения. Ваши чувства и опыт не оцениваются как «правильные» или «неправильные» — они принимаются как часть вашей истории.',
                        'position' => 0,
                    ],
                    [
                        'title' => 'Конфиденциальность',
                        'description' => 'Всё, чем вы делитесь на консультациях, остаётся между нами. Соблюдаю профессиональную этику и не разглашаю информацию третьим лицам. О границах конфиденциальности (редкие исключения по закону) говорю на первой встрече.',
                        'position' => 1,
                    ],
                    [
                        'title' => 'Опора на научную базу',
                        'description' => 'Использую методы с доказанной эффективностью и регулярно повышаю квалификацию. Не ставлю медицинские диагнозы и при необходимости порекомендую обратиться к психиатру или другому специалисту.',
                        'position' => 2,
                    ],
                    [
                        'title' => 'Ваш темп и ваши цели',
                        'description' => 'Не подгоняю под «норму» и не навязываю длительность курса. Темп работы и цели определяем вместе; вы вправе в любой момент остановить или изменить формат консультаций.',
                        'position' => 3,
                    ],
                ],
            ],
            [
                'title' => 'Education & credentials',
                'slug' => 'about_education',
                'description' => 'Образование и повышение квалификации.',
                'position' => 3,
                'posts' => [
                    [
                        'title' => 'Высшее образование',
                        'description' => 'Психология (указать вуз и год окончания). Специализация: клиническая / общая / социальная психология (выберите и отредактируйте под себя).',
                        'position' => 0,
                    ],
                    [
                        'title' => 'Дополнительное обучение',
                        'description' => 'Повышение квалификации в области психологического консультирования, краткосрочные программы по работе с тревогой, кризисами, парой (указать курсы и годы). Регулярно прохожу супервизию.',
                        'position' => 1,
                    ],
                    [
                        'title' => 'Членство и этика',
                        'description' => 'Руководствуюсь этическим кодексом психолога (указать профессиональную ассоциацию при наличии). Работаю в рамках конфиденциальности и не разглашаю содержание консультаций.',
                        'position' => 2,
                    ],
                ],
            ],
            [
                'title' => 'Reassurance',
                'slug' => 'about_reassurance',
                'description' => 'Кратко о формате работы и первой встрече.',
                'position' => 4,
                'posts' => [
                    [
                        'title' => 'С кем и как я работаю',
                        'description' => 'Работаю со взрослыми (18+) в формате индивидуальных консультаций. Темы: тревога, стресс, выгорание, отношения, самооценка, кризисы, утрата. Первая встреча — это возможность познакомиться, рассказать о запросе и задать вопросы. Решение о продолжении работы всегда остаётся за вами. Если ваш запрос выходит за рамки моей компетенции, я честно скажу об этом и по возможности порекомендую, к кому обратиться.',
                        'position' => 0,
                    ],
                ],
            ],
        ];

        foreach ($blocksConfig as $data) {
            $block = new Block();
            $block->setPage($page);
            $block->setTitle($data['title']);
            $block->setSlug($data['slug']);
            $block->setDescription($data['description']);
            $block->setPosition($data['position']);
            $block->setIsActive(true);
            $manager->persist($block);

            foreach ($data['posts'] as $postData) {
                $post = new Post();
                $post->setBlock($block);
                $post->setTitle($postData['title']);
                $post->setDescription($postData['description']);
                $post->setPosition($postData['position']);
                $post->setIsActive(true);
                $manager->persist($post);
            }
        }

        $manager->flush();
    }
}
